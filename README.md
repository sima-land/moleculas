# Библиотека компонентов www.sima-land.ru

## Начало работы

### Подключение

Для подключения к проекту используйте ```yarn add "@dev-dep/moleculas"```

### Консольные команды, необходимые в процессе разработки

* ```yarn test``` - запуск тестов *Jest*
* ```yarn lint``` - запуск линтера *ESLint*
* ```yarn storybook``` - запуск витрины компонентов *Storybook*

## Соглашения
1. В проекте используется линтер *ESLint*. Чтобы сделать ```commit``` и ```push``` в репозиторий, изменения должны пройти проверку линтером.
2. Необходимо полное покрытие тестами всего функционала. Чтобы сделать ```push``` в репозиторий, все тесты должны пройти успешно.
3. Коммиты должны быть оформлены по следующему шаблону:
    ```
    [№ задачи в GitLab] [Название задачи в GitLab]
    
    [Изменение №1]
    [Изменение №2]
    ...
    [Изменение №n]
    ```
    Пример:
    ```
    #62 Подключить отладку серверного приложения, написать документацию по работе с проектом
    
    Внесены изменения в README.md, добавлены инструкции по началу работы в проекте
    Добавлены конфигурационные файлы для Jest
    Настроена отладка приложения в режиме разработки, инструкции по настройке IDE добавлены в README.md
    ```
4. Для каждого предоставляемого библиотекой компонента должны быть описаны принимаемые им параметры с использованием [PropTypes](https://www.npmjs.com/package/prop-types).
Это позволит выводить предупреждения в режиме разработки при попытке передать в компонент параметр, **не свойственный** компоненту, либо с **неверным типом** данных.  
Так же все параметры, описанные через [PropTypes](https://www.npmjs.com/package/prop-types), будут отображаться в документации компонента в [витрине компонентов](#витрина-компонентов) с соответствующим описанием типа и назначением.

## Отладка 

Для отладки иногда полезно подключить данную библиотеку к проекту напрямую, сделав symlink в файловой системе.

1. Клонируем библиотеку. Заходим в папку этой библиотеки и делаем ```yarn build && cd build && yarn link```. Это нужно сделать 1 раз.
2. Заходим в папку проекта к которому подключена библиотека и делаем ```yarn link "@dev-dep/moleculas"```. Это 
приведет к тому, что код в node_modules будет заменен на ссылку в вашей FS.
3. Для возврата в нормальный режим  ```yarn unlink "@dev-dep/moleculas" && yarn install --force```

Примечание: Если возникли ошибки с реактом/хуками, и одной из проблем в логе ошибки значится дублирование react'a,
следует сделать линк реакта молекул с реактом проекта:
1. Директория проекта куда добавлены молекулы `cd ./node_modules/react && yarn link`.
2. Директория молекул `yarn link "react"`.

## Витрина компонентов

В качестве витрины компонентов для отображения размещенных в библиотеке компонентов используется
<a href="https://storybook.js.org/">storybook</a>.

Истории и документация компонентов позволяют увидеть варианты использования компонента с различными свойствами и примеры использования не вникая в код и логику компонента, что позволяет ускорить разработку при использовании библиотеки.
Поэтому, при создании историй/документации компонентов необходимо учитывать различные **варианты использования** и различные **комбинации входных параметров**.

### Соглашения
Истории компонентов должны соответствовать формату `*.stories.(js|jsx|mdx)`.
  
Истории и вспомогательные файлы должны размещаться в директории `__stories__` в директории компонента.

Для корректного отображения свойств компонента с помощью [PropTypes](https://www.npmjs.com/package/prop-types) в историях должны импортироваться чистые компоненты (без HOC).
  
### Требования к историям/документации
**История должна содержать:**  
- Вариант использования компонента;
- Наименование, соответствующее варианту использования;
- Необходимые начальные свойства (их можно изменить в UI Storybook на вкладке _Controls_).  
  
**Документация/блок историй должны содержать:**
- Наименование компонента с префиксом группы, например `desktop/MyComponent`;
- Текстовое описание компонента;
- Блок кода с примером использования компонента;
- Таблицу свойств компонента (генерируется [PropTypes](https://www.npmjs.com/package/prop-types));
- Если компонент принимает в параметрах функции-обработчики, то они должны быть объявлены как [action](https://storybook.js.org/docs/react/essentials/actions), для отображения выполнения обработчиков на вкладке _Actions_ в UI.
Для свойств-обработчиков, чьи имена начинаются с `on*` добавление [action](https://storybook.js.org/docs/react/essentials/actions) происходит автоматически, дополнительных действий с ними не требуется.

### Различия в форматах историй
1. `JSX`  
  Подойдет для создания [небольших историй](https://storybook.js.org/docs/react/writing-docs/docs-page), которым не требуется сложная документация (документация будет сгенерирована автоматически на основе историй и PropTypes).
2. `MDX`  
  Подходит для создания [сложной документации](https://storybook.js.org/docs/react/writing-docs/mdx) с использованием _markdown_ разметки.
  Истории создаются в этом же файле. Благодаря разметке можно добавлять блоки кода с примером использования компонента (использование для создания истории зачастую отличается от использования в компоненте).
3. `JSX` + `MDX`  
  [Комбинированный подход](https://github.com/storybookjs/storybook/blob/master/addons/docs/docs/recipes.md#csf-stories-with-mdx-docs), при котором истории создаются в `.jsx` и импортируются в документацию `.mdx`.
  Благодаря этому по прежнему можно писать сложную документацию и сохранить удобство в виде подсветки синтаксиса и помощи линтера при создании истории (чего лишен `.mdx`).


